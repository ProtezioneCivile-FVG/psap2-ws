<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

		<title>Scheda Contatto</title>

		<style>
			.underlined {
				border-bottom: 1px solid black;
			}
			.bordered-box {
				border: 1px solid black;
				border-radius: 0.5em;
				padding: 0.2em;
			}
			.ltext { text-align: left; }
			.rtext { text-align: right; }
			.ctext { text-align: center; }
			.boxed {
				border: 1px solid black;
				width: 1em;
				height: 1em;
			}
			#resultbox {
				display: none;
			}
		</style>
	</head>
	<body>
		<section id="searchbox" class="container-fluid">
			<form>
				<div class="row">
					<div class="col-1"></div>
					<div class="col">
						<div class="input-group mb-3">
							<input type="text" id="cardid" value="" size="10" class="form-control" placeholder="ID Scheda">
							<div class="input-group-append">
								<button type="button" class="btn btn-primary" onclick="getCard()">Cerca scheda</button>
							</div>
						</div>
					</div>
					<div class="col-1"></div>
				</div>
			</form>
		</section>
		<section id="resultbox" >
			<div class="container-fluid">
				<div class="row underlined">
					<div class="col"><b>DATI RIEPILOGATIVI EVENTO N째 <span data-id="card_ID"></span></b></div>
					<div class="col-3 rtext"><b><span data-id="card_CreateDate" date-format="DD/MM/YYYY hh:mm"></span></b></div>
				</div>
				<div class="row">
					<div class="col-2 rtext"><b>Referente:</b> </div>
					<div class="col-3"><span data-id="card_Reference"></span></div>
					<div class="col-3 rtext"><b>Operatore apertura:</b> </div>
					<div class="col-4"><span data-id="card_Operator"></span></div>
				</div>
				<div class="row">
					<div class="col-5"></div>
					<div class="col-3 rtext"><b>Operatore chiusura:</b> </div>
					<div class="col-4"><span data-id="card_CLOSER"></span></div>
				</div>
				<div class="bordered-box">
					<div class="row">
						<div class="col-2 ctext"><span data-id="card_CreateDate" date-format="DD/MM/YYYY hh:mm"></span></div>
						<div class="col-4 rtext"><b>Ereditato da scheda n째: </b><span data-id="card_"></span></div>
						<div class="col-2 rtext"><b>Chiamante: </b></div>
						<div class="col-4"><span data-id="card_Caller_x"></span></div>
					</div>
					<div class="row">
						<div class="col-2"></div>
						<div class="col-4 rtext"><b>Collegato a scheda n째: </b><span data-id="card_ContactCardLink"></span></div>
						<div class="col-2 rtext"><b>Dett.Chiam: </b></div>
						<div class="col-4"><span data-id="card_Caller_x"></span></div>
					</div>
					<div class="row">
						<div class="col-2 rtext"><b>Telefono:</b></div>
						<div class="col-2 ctext"><span data-id="card_Caller_Number"></span></div>
						<div class="col-2 rtext"><b>Pz.Critico: </b><span data-id="card_HighPriority" class="boxed" data-format="check"></span></div>
						<div class="col-2 rtext"><b>Cognome: </b></div>
						<div class="col-2"><span data-id="card_Caller_Surname"></span></div>
					</div>
					<div class="row">
						<div class="col-2 rtext"></div>
						<div class="col-4 ctext"></div>
						<div class="col-2 rtext"><b>Nome: </b></div>
						<div class="col-2"><span data-id="card_Caller_Name"></span></div>
					</div>
					<div class="row">
						<div class="col-2 rtext"><b>POI:</b></div>
						<div class="col-2 ctext"></div>
						<div class="col-2 rtext"></div>
						<div class="col-2 rtext"><b>Lat.: </b></div>
						<div class="col-1 rtext"><span data-id="card_MainLocation_Point_Latitude"></span></div>
						<div class="col-2 "><b>Lon.: </b><span data-id="card_MainLocation_Point_Longitude"></span></div>
					</div>
					<div class="row">
						<div class="col-2 rtext"><b>COMUNE:</b></div>
						<div class="col-4 ltext"><span data-id="card_Caller_Location_Manual_City"></span></div>
						<div class="col-2 rtext"><b>Comune:</b></div>
						<div class="col-4 ltext"><span data-id="card_Caller_Location_Manual_District"></span> (<span data-id="card_Caller_Location_Manual_Province"></span>)</span></div>
					</div>
					<div class="row">
						<div class="col-2 rtext"><b><span data-id="card_Caller_Location_Manual_Toponymy">VIA</span>:</b></div>
						<div class="col-4 ltext"><span data-id="card_Caller_Location_Manual_Address"></span> N째 <span data-id="card_Caller_Location_Manual_CivicNumber"></span></div>
					</div>
					<div class="row">
						<div class="col-2 rtext"><b>Incrocio:</b></div>
						<div class="col-4 ltext"><span data-id="card_Caller_Location_Manual_CrossRoads_Address"></span></div>
						<div class="col-2 rtext"><b>Rif:</b></div>
						<div class="col-4 ltext"><span data-id="card_Caller_Location_Manual_AdditionalInfo"></span></div>
					</div>
				</div>
				<div class="row">
					<div class="col-3 rtext"><b>Classificazione:</b> </div>
					<div class="col-3"><span data-id="card_Classification"></span></div>
					<div class="col-3 rtext"><b>Giudizio sintesi:</b> </div>
				</div>
				<div class="row">
					<div class="col-3 rtext"><b>Dettaglio Classificazione:</b> </div>
					<div class="col-3"><span data-id="card_ClassificationDetail"></span></div>
				</div>
				<div class="row">
					<div class="col-3 rtext"><b>Dinamica Riscontrata:</b> </div>
					<div class="col-3"><span data-id="card_ClassificationAttribute"></span></div>
				</div>
				<hr>
				<div class="row" style="margin-top: 1em;">
					<div class="col-1 rtext">Dati grezzi:</div>
					<div class="col bordered-box"><pre id="result"></pre></div>
				</div>
			</div>
			
		</section>

		<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>		

		<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.25.3/moment.min.js"></script>

		<script>
			function fillData( card ) {
				$('[data-id]').each( function(ix) {
					var e = $(this);
					var path = e.attr('data-id').replace('card_','').split('_');
					var d = card;
					for( var i=0; i<path.length; i++ ) {
						d = d[path[i]];
						if( !d ) break;
					}
					if( d ) {
						var df = e.attr('date-format');
						if( df ) d = moment(d).format(df);
						df = e.attr('data-format');
						if( df == 'check' ) {
							if(d == 'FALSE' ) d = '_'; else d = 'X';
						}
						e.text( d );
					}

				});
			}
			function getCard() {
				var el = document.getElementById('cardid');
				var id = el.value;
				axios.get('/api/card/' + id).then( function( response ) {
					var pre = document.getElementById('result');
					pre.innerText = JSON.stringify(response.data,null,'\t');
					fillData(response.data.data);
					$('#resultbox').show();
				})
			}
		</script>
	</body>
</html>